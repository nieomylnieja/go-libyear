FROM golang:1.21-alpine3.18 AS builder

WORKDIR /src

COPY ./test/test_server.go ./
RUN go mod init test_server

RUN go build -o /artifacts/test_server .

FROM bats/bats

RUN apk --no-cache --update add gettext

COPY ./test ./test
COPY --from=golibyear-test-bin ./golibyear /bin/golibyear
COPY --from=builder /artifacts/test_server /bin/test_server
